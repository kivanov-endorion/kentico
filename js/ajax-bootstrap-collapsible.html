<!-- 
/* Ajax SQL Data Source */ 
SELECT *
  FROM (
    SELECT * 
    FROM View_CMS_Tree_Joined INNER JOIN CONTENT_SimpleArticle ON View_CMS_Tree_Joined.DocumentForeignKeyValue = CONTENT_SimpleArticle.ArticleID
    WHERE (ClassName = 'CMS.SimpleArticle')
) AS V
WHERE NodeSiteID = 4 
AND NodeAliasPath LIKE '/ONE-IM-B4/Services-and-Trainings/Vendors/%'
AND DocumentCanBePublished = 1

/8 Ajax transformation (/content-items/ajax/vendors/getvendorsservices) */
{% if(DataItemIndex == 0) { "{\"data\": [" #%}
{"ArticleTitle":"{% ArticleTitle %}","ArticleText":"{% ArticleText %}"}
{% if (DataItemIndex + 1 != DataItemCount) {","} #%}
{% if (DataItemIndex + 1 == DataItemCount) {"]}"} #%}
 -->
<!-- 
 Assuming this JSON.
{"data": [
    {"ArticleTitle":"HPE","ArticleText":""},
    {"ArticleTitle":"Microsoft","ArticleText":"<p>test text</p>"}
    
    ]}
 -->

<!-- 
{% if (DataItemIndex == 0) {"<div class='d-flex justify-content-center align-items-center flex-wrap'>"} %}
    <a data-vendor-name="{% ArticleTitle.Replace(" ","-") %}" class="vendor-logo card p-2 lift" href="#vendor_{% ArticleTitle.Replace(" ","-") %}" data-toggle="collapse" aria-expanded="false" aria-controls="vendor_{% ArticleTitle.Replace(" ","-") %}">
      <img class="lazyload" data-src="~/logos/GetLogo.ashx?name={% ArticleTitle.Replace(" ","-") %}&size=125" alt="{% ArticleTitle %}">  
    </a>
{% if (DataItemIndex == DataItemCount - 1) {"</div>"} %}
 -->

<script>
$(document).ready(function() {
    $(".vendor-logo").click(function(e) {
        $.ajax({
            type: 'POST', url: "/content-items/ajax/vendors/getvendorsservices?vendor=" + $(this).data('vendor-name') + "", dataType: 'json', success: function(data) {
            $("#vendors").empty().append(
                "<div class='collapse' id='vendor_" + data.items[0].ArticleTitle + "'>"+
                    "<button type='button' class='btn-close border btn-floating btn-light float-right mx-3 text-danger' aria-label='Close'>"+
                        "<i class='fas fa-times'></i>"+
                    "</button>"+
                    "<div class='card card-body bg-light'>"+
                        "<div class='row align-items-center'>"+
                        "<div class='col-md-3 d-flex align-items-center justify-content-center'>"+
                            "<img data-wow-delay='350ms' style='width: 200px;' class='wow zoomIn lazyload' data-src='/logos/GetLogo.ashx?name=" + data.items[0].ArticleTitle + "' alt='" + data.items[0].ArticleTitle + "'>"+
                        "</div>"+
                        "<div class='col-md-9'>"+
                            data.items[0].ArticleText +
                        "</div>"+
                        "</div>"+
                    "</div>"+
                "</div>"
            );
            $("#vendor_" + data.items[0].ArticleTitle + "").collapse("toggle");
            $(".btn-close").on("click", function() {
                $("#vendor_" + data.items[0].ArticleTitle + "").collapse("hide");
            });

            var mouse_is_inside = false;
            $("#vendor_" + data.items[0].ArticleTitle + "").hover(function() { 
                mouse_is_inside = true; 
            }, function(){ 
                mouse_is_inside = false; 
            });
            $("body").mouseup(function() { 
                if(! mouse_is_inside) $("#vendor_" + data.items[0].ArticleTitle + "").collapse("hide");
            });                
        }});
    });
})
</script>